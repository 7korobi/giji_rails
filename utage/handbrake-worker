#! /bin/sh

echo enter title:
read title
test '' = "$title" && exit
find . -type f | grep "$title" | sort -r > /tmp/handbrake-src.txt
cat /tmp/handbrake-src.txt

echo enter grep:
read grep
cat /tmp/handbrake-src.txt | grep "$grep" > /tmp/handbrake.txt
cat /tmp/handbrake.txt

echo enter author:
read author
test '' = "$author" && exit

cat /c/media/BitTorrent/rename-1-prescan.sed /c/media/BitTorrent/rename-2-post.sed /c/media/BitTorrent/rename-9-title.sed > /c/media/handbrake.sed
dtitle=`echo "$title" | sed -f /c/media/handbrake.sed`
target="[$author] $dtitle"

echo $target
mkdir -p "$OUT/$target"
ls       "$OUT/$target" || exit

cat /tmp/handbrake.txt | while read SRC
do
  postfix=` echo "$SRC" | sed -e "s/$author//g" | sed -e "s/$title//g" | sed -f /c/media/flatten-make.sed`
  DST="$target/$dtitle-"` echo "$postfix" | sed -f /c/media/handbrake.sed`
  echo "$DST"

  test -f "$OUT/$DST.$STYLE" || echo $HANDBRAKE $GRAPH $EXT $AUDIO -i \""$SRC"\" -o \""$OUT/$DST.$STYLE"\" >> ./handbrake.sh
done
